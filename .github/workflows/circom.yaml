name: circom
run-name: ${{ github.actor }} is building a circom circuit
on: [push]
jobs:
  circom-build-circuit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: install circom
        run: |
          curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh -s -- -y
          git clone https://github.com/iden3/circom.git
          cd circom
          cargo build --release
          cargo install --path circom
      - name: run circom
        run: circom --help
      - name: install snarkjs
        run: npm install -g snarkjs@latest
      - name: install zeto
        run: |
          git clone https://github.com/hyperledger-labs/zeto.git
          cd zkp/circuits
          npm install
          cd ..
          circom circuits/anon_enc_nullifier.circom --output ./js/lib --sym --wasm
          circom circuits/anon_enc.circom --output ./js/lib --sym --wasm
          circom circuits/anon_nullifier.circom --output ./js/lib --sym --wasm
          circom circuits/anon.circom --output ./js/lib --sym --wasm
          circom circuits/check-nullifiers.circom --output ./js/lib --sym --wasm
          circom circuits/nf_anon_nullifier.circom --output ./js/lib --sym --wasm
          circom circuits/nf_anon.circom --output ./js/lib --sym --wasm
      - name: create folder
        run: mkdir -p ./proving-keys
      - name: current folder
        run: pwd
      - name: list files
        run: ls -la
      - name: download ptau
        run: |
          cd proving-keys
          wget -nv https://storage.googleapis.com/zkevm/ptau/powersOfTau28_hez_final_12.ptau  
      - name: generate proving keys
        run: |
          cd zkp/
          pwd
          ls -la
          circom circuits/anon_enc_nullifier.circom --output ./proving-keys --r1cs
          circom circuits/anon_enc.circom --output ./proving-keys --r1cs
          circom circuits/anon_nullifier.circom --output ./proving-keys --r1cs
          circom circuits/anon.circom --output ./proving-keys --r1cs
          circom circuits/check-nullifiers.circom --output ./proving-keys --r1cs
          circom circuits/nf_anon_nullifier.circom --output ./proving-keys --r1cs
          circom circuits/nf_anon.circom --output ./proving-keys --r1cs


